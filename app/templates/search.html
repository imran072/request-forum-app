{% extends 'default.html' %}

{% block title %}Vehicles - EV Marketplace{% endblock %}

{% block content %}
<main class="flex-grow-1">
    <section class="vehicle-filter">
        <form id="filter-form" method="get" action="{{ url_for('main.vehicles') }}">
            <div class="filter-group">
                <label for="make">Make / Model</label>
                <select name="make" id="make" data-selected="{{ make }}">
                    <option value="any" {% if make == 'any' %}selected{% endif %}>Any Make</option>
                    {% for make_option in makes %}
                        <option value="{{ make_option }}" {% if make_option == make %}selected{% endif %}>{{ make_option }}</option>
                    {% endfor %}
                </select>
                <select name="model" id="model" data-selected="{{ model }}">
                    <option value="any" {% if model == 'any' %}selected{% endif %}>Any Model</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="price">Price</label>
                <div class="price-range">
                    <input type="number" name="min_price" placeholder="(min)" min="0" value="{{ min_price if min_price != 'any' else '' }}">
                    <input type="number" name="max_price" placeholder="(max)" min="0" value="{{ max_price if max_price != 'any' else '' }}">
                </div>
            </div>
            <div class="filter-group">
                <label for="mileage">Mileage</label>
                <select name="mileage" id="mileage">
                    <option value="any" {% if mileage_value == 'any' %}selected{% endif %}>Any Mileage</option>
                    {% for mile in mileage %}
                        <option value="{{ mile }}" {% if mile == mileage_value %}selected{% endif %}>{{ mile }} km</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-group">
                <label for="year">Year</label>
                <div class="year-range">
                    <input type="number" name="from_year" placeholder="(from)" min="1900" value="{{ from_year if from_year != 'any' else '' }}">
                    <input type="number" name="to_year" placeholder="(to)" min="1900" value="{{ to_year if to_year != 'any' else '' }}">
                </div>
            </div>
            <div class="filter-group">
                <label for="top_speed">Top Speed</label>
                <select name="top_speed" id="top_speed">
                    <option value="any" {% if top_speed_value == 'any' %}selected{% endif %}>Any Top Speed</option>
                    {% for speed in top_speed %}
                        <option value="{{ speed }}" {% if speed == top_speed_value %}selected{% endif %}>{{ speed }} km/h</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-group">
                <label for="acceleration">Acceleration</label>
                <select name="acceleration" id="acceleration">
                    <option value="any" {% if acceleration_value == 'any' %}selected{% endif %}>Any Acceleration</option>
                    {% for acc in acceleration %}
                        <option value="{{ acc }}" {% if acc == acceleration_value %}selected{% endif %}>0-100 km/h in {{ acc }} seconds</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-group">
                <label for="color">Color</label>
                <select name="color" id="color">
                    <option value="any" {% if color == 'any' %}selected{% endif %}>Any Color</option>
                    {% for clr in colors %}
                        <option value="{{ clr }}" {% if clr == color %}selected{% endif %}>{{ clr }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="filter-button">Find My EV</button>
        </form>
    </section>

    {% if vehicles_found %}
    <section class="vehicle-results">
        <div class="vehicle-summary">
            <p>{{ vehicles|length }} EV{{ 's' if vehicles|length > 1 else '' }} found</p>
            <div class="tags">
                {% if make != 'any' %}<button class="filter-button" data-filter="make">{{ make }} <span>&times;</span></button>{% endif %}
                {% if model != 'any' %}<button class="filter-button" data-filter="model">{{ model }} <span>&times;</span></button>{% endif %}
                {% if acceleration_value != 'any' %}<button class="filter-button" data-filter="acceleration">{{ acceleration_value }} <span>&times;</span></button>{% endif %}
                {% if color != 'any' %}<button class="filter-button" data-filter="color">{{ color }} <span>&times;</span></button>{% endif %}
                <button id="clear-all">Clear All</button>
            </div>
        </div>
        <div class="vehicle-grid">
            {% for vehicle in vehicles %}
            <div class="vehicle-card">
                <div class="vehicle-info">
                    <h3>{{ vehicle.make }} {{ vehicle.model }}</h3>
                    <p>${{ vehicle.price }}</p>
                    <p>{{ vehicle.year }} - {{ vehicle.mileage }} km</p>
                    <p>Top Speed: {{ vehicle.top_speed }} km/h</p>
                    <p>Acceleration: 0-100 km/h in {{ vehicle.acceleration }} seconds</p>
                    <p>Location: {{ vehicle.seller.name }} - {{ vehicle.seller.email }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% else %}
    <section class="vehicle-results">
        <div class="vehicle-summary">
            <p>No vehicles found. Try adjusting your filters.</p>
        </div>
    </section>
    {% endif %}
</main>
{% endblock %}
